<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>비밀번호 찾기 | ESG Insight</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Noto Sans KR', sans-serif; }
        .step.active .step-number { background: linear-gradient(135deg, #10b981, #06b6d4); color: white; }
        .step.completed .step-number { background: #10b981; color: white; }
        .step.completed .step-number svg { display: block; }
        .step.completed .step-number span { display: none; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white border-b border-gray-200">
        <div class="max-w-md mx-auto px-6 py-4 flex items-center justify-center">
            <a href="/" class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-emerald-500 to-cyan-500 flex items-center justify-center">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                    </svg>
                </div>
                <span class="font-bold text-lg text-gray-900">ESG Insight</span>
            </a>
        </div>
    </nav>

    <main class="max-w-md mx-auto px-6 py-12">
        <!-- Steps Indicator -->
        <div class="flex justify-between items-center mb-8">
            <div class="step active flex flex-col items-center" id="step1-indicator">
                <div class="step-number w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center font-bold text-gray-500 mb-2">
                    <span>1</span>
                    <svg class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <span class="text-xs text-gray-500">이메일 입력</span>
            </div>
            <div class="flex-1 h-1 bg-gray-200 mx-2" id="progress1"></div>
            <div class="step flex flex-col items-center" id="step2-indicator">
                <div class="step-number w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center font-bold text-gray-500 mb-2">
                    <span>2</span>
                    <svg class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <span class="text-xs text-gray-500">인증 코드</span>
            </div>
            <div class="flex-1 h-1 bg-gray-200 mx-2" id="progress2"></div>
            <div class="step flex flex-col items-center" id="step3-indicator">
                <div class="step-number w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center font-bold text-gray-500 mb-2">
                    <span>3</span>
                    <svg class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <span class="text-xs text-gray-500">비밀번호 재설정</span>
            </div>
        </div>

        <!-- Step 1: 이메일 입력 -->
        <div id="step1" class="step-content">
            <div class="bg-white rounded-2xl p-8 shadow-sm border border-gray-200">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                        </svg>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-900 mb-2">비밀번호 찾기</h1>
                    <p class="text-gray-500">가입하신 이메일 주소를 입력하시면<br>비밀번호 재설정 링크를 보내드립니다.</p>
                </div>

                <form onsubmit="sendResetEmail(event)">
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">이메일</label>
                        <input type="email" id="email" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-emerald-500/30 focus:border-emerald-500" placeholder="name@company.com">
                    </div>
                    <button type="submit" class="w-full py-4 bg-gradient-to-r from-emerald-500 to-cyan-500 text-white rounded-xl font-bold hover:opacity-90 transition-opacity">
                        인증 코드 받기
                    </button>
                </form>

                <p class="text-center text-gray-500 text-sm mt-6">
                    비밀번호가 기억나셨나요? <a href="/" class="text-emerald-600 font-medium hover:underline" onclick="openLogin()">로그인</a>
                </p>
            </div>
        </div>

        <!-- Step 2: 인증 코드 입력 -->
        <div id="step2" class="step-content hidden">
            <div class="bg-white rounded-2xl p-8 shadow-sm border border-gray-200">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                        </svg>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-900 mb-2">인증 코드 입력</h1>
                    <p class="text-gray-500"><span id="maskedEmail">j***@company.com</span>으로<br>6자리 인증 코드를 보냈습니다.</p>
                </div>

                <form onsubmit="verifyCode(event)">
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">인증 코드</label>
                        <div class="flex gap-2">
                            <input type="text" maxlength="1" class="code-input w-12 h-14 text-center text-2xl font-bold border border-gray-300 rounded-xl focus:ring-2 focus:ring-emerald-500/30 focus:border-emerald-500" oninput="moveToNext(this, 1)">
                            <input type="text" maxlength="1" class="code-input w-12 h-14 text-center text-2xl font-bold border border-gray-300 rounded-xl focus:ring-2 focus:ring-emerald-500/30 focus:border-emerald-500" oninput="moveToNext(this, 2)">
                            <input type="text" maxlength="1" class="code-input w-12 h-14 text-center text-2xl font-bold border border-gray-300 rounded-xl focus:ring-2 focus:ring-emerald-500/30 focus:border-emerald-500" oninput="moveToNext(this, 3)">
                            <input type="text" maxlength="1" class="code-input w-12 h-14 text-center text-2xl font-bold border border-gray-300 rounded-xl focus:ring-2 focus:ring-emerald-500/30 focus:border-emerald-500" oninput="moveToNext(this, 4)">
                            <input type="text" maxlength="1" class="code-input w-12 h-14 text-center text-2xl font-bold border border-gray-300 rounded-xl focus:ring-2 focus:ring-emerald-500/30 focus:border-emerald-500" oninput="moveToNext(this, 5)">
                            <input type="text" maxlength="1" class="code-input w-12 h-14 text-center text-2xl font-bold border border-gray-300 rounded-xl focus:ring-2 focus:ring-emerald-500/30 focus:border-emerald-500" oninput="moveToNext(this, 6)">
                        </div>
                    </div>

                    <button type="submit" class="w-full py-4 bg-gradient-to-r from-emerald-500 to-cyan-500 text-white rounded-xl font-bold hover:opacity-90 transition-opacity">
                        확인
                    </button>
                </form>

                <div class="text-center mt-6">
                    <p class="text-gray-500 text-sm mb-2">코드를 받지 못하셨나요?</p>
                    <button onclick="resendCode()" class="text-emerald-600 font-medium hover:underline text-sm" id="resendBtn">
                        인증 코드 다시 보내기
                    </button>
                    <p class="text-gray-400 text-xs mt-2" id="timer">03:00 남음</p>
                </div>
            </div>
        </div>

        <!-- Step 3: 새 비밀번호 설정 -->
        <div id="step3" class="step-content hidden">
            <div class="bg-white rounded-2xl p-8 shadow-sm border border-gray-200">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"></path>
                        </svg>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-900 mb-2">새 비밀번호 설정</h1>
                    <p class="text-gray-500">새로운 비밀번호를 입력해주세요.</p>
                </div>

                <form onsubmit="resetPassword(event)">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">새 비밀번호</label>
                        <div class="relative">
                            <input type="password" id="newPassword" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-emerald-500/30 focus:border-emerald-500 pr-12" placeholder="새 비밀번호 입력" oninput="checkPasswordStrength()">
                            <button type="button" onclick="togglePassword('newPassword')" class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </button>
                        </div>
                        <!-- 비밀번호 강도 표시 -->
                        <div class="mt-2">
                            <div class="flex gap-1 mb-1">
                                <div class="h-1 flex-1 rounded bg-gray-200" id="strength1"></div>
                                <div class="h-1 flex-1 rounded bg-gray-200" id="strength2"></div>
                                <div class="h-1 flex-1 rounded bg-gray-200" id="strength3"></div>
                                <div class="h-1 flex-1 rounded bg-gray-200" id="strength4"></div>
                            </div>
                            <p class="text-xs text-gray-500" id="strengthText">8자 이상, 영문/숫자/특수문자 포함</p>
                        </div>
                    </div>

                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">비밀번호 확인</label>
                        <div class="relative">
                            <input type="password" id="confirmPassword" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-emerald-500/30 focus:border-emerald-500 pr-12" placeholder="비밀번호 다시 입력" oninput="checkPasswordMatch()">
                            <button type="button" onclick="togglePassword('confirmPassword')" class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </button>
                        </div>
                        <p class="text-xs mt-1 hidden" id="matchText"></p>
                    </div>

                    <button type="submit" class="w-full py-4 bg-gradient-to-r from-emerald-500 to-cyan-500 text-white rounded-xl font-bold hover:opacity-90 transition-opacity">
                        비밀번호 변경
                    </button>
                </form>
            </div>
        </div>

        <!-- Step 4: 완료 -->
        <div id="step4" class="step-content hidden">
            <div class="bg-white rounded-2xl p-8 shadow-sm border border-gray-200 text-center">
                <div class="w-20 h-20 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <svg class="w-10 h-10 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <h1 class="text-2xl font-bold text-gray-900 mb-2">비밀번호 변경 완료!</h1>
                <p class="text-gray-500 mb-8">새로운 비밀번호로 로그인해주세요.</p>
                <a href="/" class="inline-block w-full py-4 bg-gradient-to-r from-emerald-500 to-cyan-500 text-white rounded-xl font-bold hover:opacity-90 transition-opacity">
                    로그인하러 가기
                </a>
            </div>
        </div>
    </main>

    <script>
        let userEmail = '';
        let timerInterval;

        // Step 1: 이메일 전송
        function sendResetEmail(e) {
            e.preventDefault();
            userEmail = document.getElementById('email').value;
            
            // 이메일 마스킹
            const parts = userEmail.split('@');
            const maskedLocal = parts[0].charAt(0) + '***';
            document.getElementById('maskedEmail').textContent = maskedLocal + '@' + parts[1];

            // Step 이동
            goToStep(2);
            startTimer();
        }

        // Step 2: 인증 코드 확인
        function verifyCode(e) {
            e.preventDefault();
            const inputs = document.querySelectorAll('.code-input');
            let code = '';
            inputs.forEach(input => code += input.value);

            if (code.length === 6) {
                // 데모: 아무 코드나 허용
                clearInterval(timerInterval);
                goToStep(3);
            } else {
                alert('6자리 인증 코드를 입력해주세요.');
            }
        }

        // Step 3: 비밀번호 재설정
        function resetPassword(e) {
            e.preventDefault();
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (newPassword.length < 8) {
                alert('비밀번호는 8자 이상이어야 합니다.');
                return;
            }

            if (newPassword !== confirmPassword) {
                alert('비밀번호가 일치하지 않습니다.');
                return;
            }

            goToStep(4);
        }

        // 단계 이동
        function goToStep(step) {
            // 모든 콘텐츠 숨기기
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.add('hidden');
            });

            // 선택된 단계 표시
            document.getElementById('step' + step).classList.remove('hidden');

            // 인디케이터 업데이트
            for (let i = 1; i <= 3; i++) {
                const indicator = document.getElementById('step' + i + '-indicator');
                indicator.classList.remove('active', 'completed');
                
                if (i < step) {
                    indicator.classList.add('completed');
                } else if (i === step) {
                    indicator.classList.add('active');
                }
            }

            // 프로그레스 바 업데이트
            if (step >= 2) {
                document.getElementById('progress1').classList.add('bg-emerald-500');
            }
            if (step >= 3) {
                document.getElementById('progress2').classList.add('bg-emerald-500');
            }
        }

        // 코드 입력 시 다음 칸으로 이동
        function moveToNext(input, index) {
            if (input.value.length === 1) {
                const inputs = document.querySelectorAll('.code-input');
                if (index < inputs.length) {
                    inputs[index].focus();
                }
            }
        }

        // 인증 코드 재전송
        function resendCode() {
            alert('인증 코드가 다시 전송되었습니다.');
            startTimer();
        }

        // 타이머 시작
        function startTimer() {
            let seconds = 180; // 3분
            const timerEl = document.getElementById('timer');
            const resendBtn = document.getElementById('resendBtn');
            
            resendBtn.disabled = true;
            resendBtn.classList.add('text-gray-400');
            resendBtn.classList.remove('text-emerald-600');

            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                const min = Math.floor(seconds / 60);
                const sec = seconds % 60;
                timerEl.textContent = `${String(min).padStart(2, '0')}:${String(sec).padStart(2, '0')} 남음`;
                
                if (seconds <= 0) {
                    clearInterval(timerInterval);
                    timerEl.textContent = '시간이 만료되었습니다';
                    resendBtn.disabled = false;
                    resendBtn.classList.remove('text-gray-400');
                    resendBtn.classList.add('text-emerald-600');
                }
                seconds--;
            }, 1000);
        }

        // 비밀번호 강도 체크
        function checkPasswordStrength() {
            const password = document.getElementById('newPassword').value;
            let strength = 0;

            if (password.length >= 8) strength++;
            if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
            if (/\d/.test(password)) strength++;
            if (/[!@#$%^&*(),.?":{}|<>]/.test(password)) strength++;

            const colors = ['bg-red-500', 'bg-orange-500', 'bg-yellow-500', 'bg-emerald-500'];
            const texts = ['매우 약함', '약함', '보통', '강함'];

            for (let i = 1; i <= 4; i++) {
                const bar = document.getElementById('strength' + i);
                bar.className = 'h-1 flex-1 rounded ' + (i <= strength ? colors[strength - 1] : 'bg-gray-200');
            }

            document.getElementById('strengthText').textContent = strength > 0 ? texts[strength - 1] : '8자 이상, 영문/숫자/특수문자 포함';
        }

        // 비밀번호 일치 확인
        function checkPasswordMatch() {
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const matchText = document.getElementById('matchText');

            if (confirmPassword.length > 0) {
                matchText.classList.remove('hidden');
                if (newPassword === confirmPassword) {
                    matchText.textContent = '비밀번호가 일치합니다';
                    matchText.className = 'text-xs mt-1 text-emerald-600';
                } else {
                    matchText.textContent = '비밀번호가 일치하지 않습니다';
                    matchText.className = 'text-xs mt-1 text-red-500';
                }
            } else {
                matchText.classList.add('hidden');
            }
        }

        // 비밀번호 표시/숨기기
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            input.type = input.type === 'password' ? 'text' : 'password';
        }
    </script>
</body>
</html>
