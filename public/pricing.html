<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESG Insight | êµ¬ë… ê²°ì œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://js.tosspayments.com/v1/payment"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Noto Sans KR', sans-serif; }
        .gradient-text {
            background: linear-gradient(135deg, #10b981 0%, #06b6d4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .plan-card.selected { border-color: #10b981; background-color: #f0fdf4; }
        .payment-method.selected { border-color: #10b981; background-color: #f0fdf4; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-6 py-4 flex items-center justify-between">
            <a href="/" class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-emerald-500 to-cyan-500 flex items-center justify-center">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                    </svg>
                </div>
                <span class="font-bold text-lg text-gray-900">ESG Insight</span>
            </a>
            <div class="flex items-center gap-4">
                <a href="/" class="text-gray-600 hover:text-gray-900 text-sm">â† í™ˆìœ¼ë¡œ</a>
                <span class="text-sm text-gray-500">ğŸ”’ ì•ˆì „í•œ ê²°ì œ</span>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto px-6 py-12">
        <div class="grid lg:grid-cols-3 gap-8">
            <!-- ì™¼ìª½: ìš”ê¸ˆì œ ì„ íƒ & ì •ë³´ ì…ë ¥ -->
            <div class="lg:col-span-2 space-y-8">
                <!-- Step 1: ìš”ê¸ˆì œ ì„ íƒ -->
                <section class="bg-white rounded-2xl p-6 shadow-sm border border-gray-200">
                    <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                        <span class="w-8 h-8 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center text-sm font-bold">1</span>
                        ìš”ê¸ˆì œ ì„ íƒ
                    </h2>
                    
                    <div class="grid md:grid-cols-3 gap-4">
                        <div class="plan-card border-2 border-gray-200 rounded-xl p-5 cursor-pointer hover:border-gray-300 transition-all" data-plan="starter" data-price="99000" onclick="selectPlan(this)">
                            <h3 class="font-bold text-gray-900 mb-1">Starter</h3>
                            <p class="text-sm text-gray-500 mb-3">ESG ê´€ë¦¬ ì‹œì‘</p>
                            <p class="text-2xl font-bold text-gray-900">â‚©99,000<span class="text-sm font-normal text-gray-500">/ì›”</span></p>
                            <ul class="mt-4 space-y-2 text-sm text-gray-600">
                                <li>âœ“ ê¸°ë³¸ ESG ë¶„ì„</li>
                                <li>âœ“ ì›” 10íšŒ AI ë¶„ì„</li>
                            </ul>
                        </div>

                        <div class="plan-card selected border-2 border-emerald-500 rounded-xl p-5 cursor-pointer transition-all relative" data-plan="professional" data-price="299000" onclick="selectPlan(this)">
                            <span class="absolute -top-3 left-1/2 -translate-x-1/2 bg-emerald-500 text-white text-xs px-3 py-1 rounded-full">ì¶”ì²œ</span>
                            <h3 class="font-bold text-gray-900 mb-1">Professional</h3>
                            <p class="text-sm text-gray-500 mb-3">ë³¸ê²©ì ì¸ ESG ê´€ë¦¬</p>
                            <p class="text-2xl font-bold gradient-text">â‚©299,000<span class="text-sm font-normal text-gray-500">/ì›”</span></p>
                            <ul class="mt-4 space-y-2 text-sm text-gray-600">
                                <li>âœ“ ë¬´ì œí•œ AI ë¶„ì„</li>
                                <li>âœ“ AI ì»¨ì„¤í„´íŠ¸</li>
                                <li>âœ“ K-ESG/GRI/TCFD</li>
                            </ul>
                        </div>

                        <div class="plan-card border-2 border-gray-200 rounded-xl p-5 cursor-pointer hover:border-gray-300 transition-all" data-plan="enterprise" data-price="599000" onclick="selectPlan(this)">
                            <h3 class="font-bold text-gray-900 mb-1">Enterprise</h3>
                            <p class="text-sm text-gray-500 mb-3">ëŒ€ê·œëª¨ ì¡°ì§</p>
                            <p class="text-2xl font-bold text-gray-900">â‚©599,000<span class="text-sm font-normal text-gray-500">/ì›”</span></p>
                            <ul class="mt-4 space-y-2 text-sm text-gray-600">
                                <li>âœ“ ì „ë‹´ ì»¨ì„¤í„´íŠ¸</li>
                                <li>âœ“ API ì—°ë™</li>
                                <li>âœ“ SLA ë³´ì¥</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- Step 2: ê²°ì œ ì •ë³´ -->
                <section class="bg-white rounded-2xl p-6 shadow-sm border border-gray-200">
                    <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                        <span class="w-8 h-8 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center text-sm font-bold">2</span>
                        ê²°ì œ ì •ë³´
                    </h2>

                    <div class="grid md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">íšŒì‚¬ëª… <span class="text-red-500">*</span></label>
                            <input type="text" id="companyName" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-emerald-500/30 focus:border-emerald-500" placeholder="íšŒì‚¬ëª…">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ë‹´ë‹¹ìëª… <span class="text-red-500">*</span></label>
                            <input type="text" id="customerName" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-emerald-500/30 focus:border-emerald-500" placeholder="í™ê¸¸ë™">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì´ë©”ì¼ <span class="text-red-500">*</span></label>
                            <input type="email" id="customerEmail" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-emerald-500/30 focus:border-emerald-500" placeholder="name@company.com">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì—°ë½ì²˜ <span class="text-red-500">*</span></label>
                            <input type="tel" id="customerPhone" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-emerald-500/30 focus:border-emerald-500" placeholder="010-1234-5678">
                        </div>
                    </div>

                    <!-- ê²°ì œ ìˆ˜ë‹¨ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">ê²°ì œ ìˆ˜ë‹¨</label>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <div class="payment-method selected border-2 border-emerald-500 rounded-xl p-4 cursor-pointer text-center" data-method="ì¹´ë“œ" onclick="selectPaymentMethod(this)">
                                <span class="text-2xl">ğŸ’³</span>
                                <p class="text-sm font-medium text-gray-700 mt-1">ì‹ ìš©ì¹´ë“œ</p>
                            </div>
                            <div class="payment-method border-2 border-gray-200 rounded-xl p-4 cursor-pointer text-center hover:border-gray-300" data-method="ê³„ì¢Œì´ì²´" onclick="selectPaymentMethod(this)">
                                <span class="text-2xl">ğŸ¦</span>
                                <p class="text-sm font-medium text-gray-700 mt-1">ê³„ì¢Œì´ì²´</p>
                            </div>
                            <div class="payment-method border-2 border-gray-200 rounded-xl p-4 cursor-pointer text-center hover:border-gray-300" data-method="ê°€ìƒê³„ì¢Œ" onclick="selectPaymentMethod(this)">
                                <span class="text-2xl">ğŸ“‹</span>
                                <p class="text-sm font-medium text-gray-700 mt-1">ê°€ìƒê³„ì¢Œ</p>
                            </div>
                            <div class="payment-method border-2 border-gray-200 rounded-xl p-4 cursor-pointer text-center hover:border-gray-300" data-method="íœ´ëŒ€í°" onclick="selectPaymentMethod(this)">
                                <span class="text-2xl">ğŸ“±</span>
                                <p class="text-sm font-medium text-gray-700 mt-1">íœ´ëŒ€í°</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Step 3: ì•½ê´€ ë™ì˜ -->
                <section class="bg-white rounded-2xl p-6 shadow-sm border border-gray-200">
                    <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                        <span class="w-8 h-8 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center text-sm font-bold">3</span>
                        ì•½ê´€ ë™ì˜
                    </h2>

                    <div class="space-y-3">
                        <label class="flex items-center gap-3 cursor-pointer p-3 rounded-lg hover:bg-gray-50">
                            <input type="checkbox" id="agreeAll" onchange="toggleAllAgree()" class="w-5 h-5 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500">
                            <span class="font-medium text-gray-900">ì „ì²´ ë™ì˜</span>
                        </label>
                        <hr>
                        <label class="flex items-center gap-3 cursor-pointer p-2 pl-3">
                            <input type="checkbox" class="agree-item w-4 h-4 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500">
                            <span class="text-sm text-gray-600">(í•„ìˆ˜) ì´ìš©ì•½ê´€ ë™ì˜</span>
                            <a href="#" class="text-sm text-emerald-600 ml-auto">ë³´ê¸°</a>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer p-2 pl-3">
                            <input type="checkbox" class="agree-item w-4 h-4 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500">
                            <span class="text-sm text-gray-600">(í•„ìˆ˜) ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜</span>
                            <a href="#" class="text-sm text-emerald-600 ml-auto">ë³´ê¸°</a>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer p-2 pl-3">
                            <input type="checkbox" class="agree-item w-4 h-4 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500">
                            <span class="text-sm text-gray-600">(í•„ìˆ˜) ì •ê¸°ê²°ì œ ë™ì˜</span>
                            <a href="#" class="text-sm text-emerald-600 ml-auto">ë³´ê¸°</a>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer p-2 pl-3">
                            <input type="checkbox" class="agree-item optional w-4 h-4 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500">
                            <span class="text-sm text-gray-600">(ì„ íƒ) ë§ˆì¼€íŒ… ì •ë³´ ìˆ˜ì‹  ë™ì˜</span>
                        </label>
                    </div>
                </section>
            </div>

            <!-- ì˜¤ë¥¸ìª½: ê²°ì œ ìš”ì•½ -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-200 sticky top-24">
                    <h3 class="font-bold text-gray-900 mb-6">ê²°ì œ ìš”ì•½</h3>

                    <div class="space-y-4 mb-6">
                        <div class="flex justify-between">
                            <span class="text-gray-600">ìš”ê¸ˆì œ</span>
                            <span class="font-medium text-gray-900" id="summaryPlan">Professional</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">ì›” ì´ìš©ë£Œ</span>
                            <span class="font-medium text-gray-900" id="summaryPrice">â‚©299,000</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">VAT (10%)</span>
                            <span class="font-medium text-gray-900" id="summaryVat">â‚©29,900</span>
                        </div>
                        <hr>
                        <div class="flex justify-between">
                            <span class="font-bold text-gray-900">ì´ ê²°ì œ ê¸ˆì•¡</span>
                            <span class="font-bold text-xl gradient-text" id="summaryTotal">â‚©328,900</span>
                        </div>
                    </div>

                    <div class="bg-emerald-50 rounded-xl p-4 mb-6">
                        <p class="text-sm text-emerald-800">
                            ğŸ’¡ <strong>14ì¼ ë¬´ë£Œ ì²´í—˜</strong> í›„ ìë™ìœ¼ë¡œ ì •ê¸° ê²°ì œê°€ ì‹œì‘ë©ë‹ˆë‹¤. ì–¸ì œë“  ì·¨ì†Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                        </p>
                    </div>

                    <button onclick="processPayment()" id="payButton" class="w-full py-4 bg-gradient-to-r from-emerald-500 to-cyan-500 text-white rounded-xl font-bold text-lg hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed">
                        â‚©328,900 ê²°ì œí•˜ê¸°
                    </button>

                    <p class="text-center text-gray-500 text-xs mt-4">
                        ğŸ”’ ê²°ì œ ì •ë³´ëŠ” SSL ì•”í˜¸í™”ë¡œ ì•ˆì „í•˜ê²Œ ë³´í˜¸ë©ë‹ˆë‹¤
                    </p>

                    <div class="flex items-center justify-center gap-4 mt-6 pt-6 border-t border-gray-200">
                        <img src="https://static.toss.im/icons/png/4x/icon-toss-logo.png" alt="Toss" class="h-6 opacity-50">
                        <span class="text-xs text-gray-400">í† ìŠ¤í˜ì´ë¨¼ì¸ ë¡œ ì•ˆì „í•˜ê²Œ ê²°ì œ</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // í† ìŠ¤í˜ì´ë¨¼ì¸  ì´ˆê¸°í™” (ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ í‚¤ë¥¼ ë°›ì•„ì˜¬ ìˆ˜ë„ ìˆìŒ)
        let tossPayments = null;
        let clientKey = null;

        let selectedPlan = {
            name: 'Professional',
            code: 'professional',
            price: 299000
        };

        let selectedMethod = 'ì¹´ë“œ';

        // ìš”ê¸ˆì œ ì„ íƒ
        function selectPlan(element) {
            document.querySelectorAll('.plan-card').forEach(card => {
                card.classList.remove('selected', 'border-emerald-500');
                card.classList.add('border-gray-200');
            });
            element.classList.add('selected', 'border-emerald-500');
            element.classList.remove('border-gray-200');

            selectedPlan.name = element.querySelector('h3').textContent;
            selectedPlan.code = element.dataset.plan;
            selectedPlan.price = parseInt(element.dataset.price);

            updateSummary();
        }

        // ê²°ì œ ìˆ˜ë‹¨ ì„ íƒ
        function selectPaymentMethod(element) {
            document.querySelectorAll('.payment-method').forEach(m => {
                m.classList.remove('selected', 'border-emerald-500');
                m.classList.add('border-gray-200');
            });
            element.classList.add('selected', 'border-emerald-500');
            element.classList.remove('border-gray-200');

            selectedMethod = element.dataset.method;
        }

        // ê²°ì œ ìš”ì•½ ì—…ë°ì´íŠ¸
        function updateSummary() {
            const vat = Math.round(selectedPlan.price * 0.1);
            const total = selectedPlan.price + vat;

            document.getElementById('summaryPlan').textContent = selectedPlan.name;
            document.getElementById('summaryPrice').textContent = 'â‚©' + selectedPlan.price.toLocaleString();
            document.getElementById('summaryVat').textContent = 'â‚©' + vat.toLocaleString();
            document.getElementById('summaryTotal').textContent = 'â‚©' + total.toLocaleString();
            document.getElementById('payButton').textContent = 'â‚©' + total.toLocaleString() + ' ê²°ì œí•˜ê¸°';
        }

        // ì „ì²´ ë™ì˜
        function toggleAllAgree() {
            const isChecked = document.getElementById('agreeAll').checked;
            document.querySelectorAll('.agree-item').forEach(item => {
                item.checked = isChecked;
            });
        }

        // í•„ìˆ˜ ì•½ê´€ ì²´í¬ í™•ì¸
        function checkRequiredAgreements() {
            const requiredItems = document.querySelectorAll('.agree-item:not(.optional)');
            return Array.from(requiredItems).every(item => item.checked);
        }

        // í¼ ìœ íš¨ì„± ê²€ì‚¬
        function validateForm() {
            const companyName = document.getElementById('companyName').value.trim();
            const customerName = document.getElementById('customerName').value.trim();
            const customerEmail = document.getElementById('customerEmail').value.trim();
            const customerPhone = document.getElementById('customerPhone').value.trim();

            if (!companyName) {
                alert('íšŒì‚¬ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return false;
            }
            if (!customerName) {
                alert('ë‹´ë‹¹ìëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return false;
            }
            if (!customerEmail || !customerEmail.includes('@')) {
                alert('ìœ íš¨í•œ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return false;
            }
            if (!customerPhone) {
                alert('ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return false;
            }
            if (!checkRequiredAgreements()) {
                alert('í•„ìˆ˜ ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”.');
                return false;
            }
            return true;
        }

        // ê²°ì œ ì²˜ë¦¬
        async function processPayment() {
            if (!validateForm()) return;

            const payButton = document.getElementById('payButton');
            payButton.disabled = true;
            payButton.textContent = 'ê²°ì œ ì¤€ë¹„ ì¤‘...';

            try {
                // 1. ì„œë²„ì—ì„œ ê²°ì œ ì¤€ë¹„ (ì£¼ë¬¸ ID ìƒì„±)
                const prepareResponse = await fetch('/api/payments/prepare', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: 'user_' + Date.now(),  // ì‹¤ì œë¡œëŠ” ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ID
                        plan: selectedPlan.code
                    })
                });

                const prepareData = await prepareResponse.json();

                if (!prepareData.success) {
                    throw new Error(prepareData.error || 'ê²°ì œ ì¤€ë¹„ ì‹¤íŒ¨');
                }

                // 2. í† ìŠ¤í˜ì´ë¨¼ì¸  ì´ˆê¸°í™” (ì„œë²„ì—ì„œ ë°›ì€ í´ë¼ì´ì–¸íŠ¸ í‚¤ ì‚¬ìš©)
                if (!tossPayments) {
                    tossPayments = TossPayments(prepareData.clientKey);
                }

                // 3. ê²°ì œì°½ í˜¸ì¶œ
                const customerName = document.getElementById('customerName').value;
                const customerEmail = document.getElementById('customerEmail').value;
                const customerPhone = document.getElementById('customerPhone').value.replace(/-/g, '');

                await tossPayments.requestPayment(selectedMethod, {
                    amount: prepareData.amount,
                    orderId: prepareData.orderId,
                    orderName: prepareData.orderName,
                    customerName: customerName,
                    customerEmail: customerEmail,
                    customerMobilePhone: customerPhone,
                    successUrl: window.location.origin + '/payment/success',
                    failUrl: window.location.origin + '/payment/fail',
                });

            } catch (error) {
                console.error('ê²°ì œ ì˜¤ë¥˜:', error);
                
                if (error.code === 'USER_CANCEL') {
                    alert('ê²°ì œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    alert('ê²°ì œ ì˜¤ë¥˜: ' + (error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }

                payButton.disabled = false;
                updateSummary();
            }
        }

        // ì´ˆê¸°í™”
        updateSummary();
        
        // URL íŒŒë¼ë¯¸í„°ì—ì„œ ìš”ê¸ˆì œ ìë™ ì„ íƒ
        const urlParams = new URLSearchParams(window.location.search);
        const planParam = urlParams.get('plan');
        if (planParam) {
            const planCard = document.querySelector(`.plan-card[data-plan="${planParam}"]`);
            if (planCard) {
                selectPlan(planCard);
            }
        }
    </script>
</body>
</html>
